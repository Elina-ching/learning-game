<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>å…ƒç´ åŸå ¡æ‹¼æ‹¼æ¨‚ï½œåœ‹ä¸­ç‰ˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap");
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: "Noto Sans TC", sans-serif;
      background-color: #e0f2fe;
      margin: 0; padding: 0;
      display: flex; justify-content: center;
      touch-action: manipulation;
      overflow: hidden;
      position: fixed; width: 100%; height: 100%;
    }
    #game-container {
      max-width: 960px; width: 100%; height: 100%;
      background: #f9fafb;
      box-shadow: 0 0 25px rgba(15,23,42,0.18);
      display: flex; flex-direction: column;
    }
    .table-wrapper {
      position: relative; flex-grow: 1;
      overflow: auto; -webkit-overflow-scrolling: touch;
      padding: 8px;
      background: radial-gradient(circle at top, #ffffff 0%, #dbeafe 45%, #bfdbfe 100%);
      border-bottom: 4px solid #93c5fd;
    }
    .periodic-grid {
      display: grid;
      grid-template-columns: repeat(18, 1fr);
      grid-template-rows: repeat(7, 1fr);
      gap: 2px;
      width: 720px; height: 360px;
      pointer-events: none;
      position: absolute; inset: 0; margin: auto;
    }
    .grid-cell {
      border: 1px dashed rgba(148,163,184,0.5);
      background-color: rgba(255,255,255,0.7);
      border-radius: 4px;
      display: flex; align-items: center; justify-content: center;
      font-size: 8px; color: #94a3b8;
      position: relative;
    }
    .grid-cell span.z { position: absolute; top: 1px; left: 2px; font-size: 7px; opacity: 0.7; }
    .grid-cell span.sym { font-size: 11px; color: #cbd5f5; }
    .floating-block {
      position: absolute;
      width: 42px; height: 42px;
      border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 16px; color: #fff;
      box-shadow: 0 8px 14px rgba(15,23,42,0.25);
      cursor: pointer; user-select: none;
      transition: transform 0.18s, box-shadow 0.18s,
        top 0.5s cubic-bezier(0.34,1.56,0.64,1),
        left 0.5s cubic-bezier(0.34,1.56,0.64,1),
        width 0.3s ease, height 0.3s ease;
      z-index: 10;
    }
    .floating-block:active { transform: translateY(2px) scale(0.97); box-shadow: 0 4px 10px rgba(15,23,42,0.18); }
    .floating-block.selected {
      border: 3px solid #facc15;
      box-shadow: 0 0 18px rgba(250,204,21,0.95);
      transform: scale(1.14); z-index: 40;
    }
    .floating-block.solved {
      border-radius: 4px;
      box-shadow: inset 0 0 6px rgba(15,23,42,0.35);
      pointer-events: none; z-index: 5;
    }
    .home-btn {
      position: fixed; top: 12px; left: 12px; z-index: 100;
      width: 44px; height: 44px;
      background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
      border-radius: 12px; border: none;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 12px rgba(245,158,11,0.4);
      cursor: pointer; transition: transform 0.2s;
    }
    .home-btn:active { transform: scale(0.92); }
    .home-btn svg { width: 26px; height: 26px; fill: #fff; }
    .virtual-keyboard {
      display: grid; grid-template-columns: repeat(10, 1fr); gap: 4px;
      padding: 8px; background: #e2e8f0; border-top: 2px solid #cbd5e1;
    }
    .vk-key {
      background: #fff; border: 1px solid #94a3b8;
      border-radius: 8px; padding: 10px 0;
      font-size: 18px; font-weight: 700; color: #1e293b;
      text-align: center; cursor: pointer;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      transition: background 0.1s, transform 0.1s;
    }
    .vk-key:active { background: #dbeafe; transform: scale(0.95); }
    .vk-key.action { background: #3b82f6; color: #fff; font-size: 14px; }
    .vk-key.action:active { background: #2563eb; }
    .vk-key.del { background: #ef4444; color: #fff; }
    .vk-key.del:active { background: #dc2626; }
    @keyframes shake { 0%,100%{transform:translateX(0)} 20%,60%{transform:translateX(-5px)} 40%,80%{transform:translateX(5px)} }
    .shake { animation: shake 0.24s ease-in-out; }
    .dot-flashing {
      position: relative; width: 10px; height: 10px;
      border-radius: 999px; background-color: #2563eb;
      animation: dot-flashing 1s infinite linear alternate; animation-delay: 0.5s;
    }
    .dot-flashing::before, .dot-flashing::after {
      content: ""; position: absolute; top: 0;
      width: 10px; height: 10px; border-radius: 999px; background-color: #2563eb;
    }
    .dot-flashing::before { left: -15px; animation: dot-flashing 1s infinite alternate; animation-delay: 0s; }
    .dot-flashing::after { left: 15px; animation: dot-flashing 1s infinite alternate; animation-delay: 1s; }
    @keyframes dot-flashing { 0%{background-color:#2563eb} 50%,100%{background-color:rgba(37,99,235,0.2)} }
  </style>
</head>
<body>
  <a href="index.html" class="home-btn" title="å›ä¸»é ">
    <svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
  </a>
  <div id="game-container">
    <header class="bg-blue-600 text-white px-4 py-3 flex items-center justify-between shadow-md">
      <div class="pl-10">
        <h1 class="text-lg font-extrabold flex items-center gap-1">ğŸ° å…ƒç´ åŸå ¡æ‹¼æ‹¼æ¨‚</h1>
        <p class="text-[10px] text-blue-100">é»é¸å…ƒç´  â†’ è¼¸å…¥ç¬¦è™Ÿ â†’ ç¢ºèªï¼</p>
      </div>
      <div class="text-right flex items-center gap-2">
        <div id="progressDisplay" class="text-2xl font-black">0/24</div>
        <button onclick="askAIHint()" class="text-[10px] bg-yellow-300 text-blue-900 px-2 py-1 rounded-full font-bold shadow">âœ¨æç¤º</button>
      </div>
    </header>
    <main class="table-wrapper" id="tableArea">
      <div class="periodic-grid" id="ghostGrid"></div>
      <div id="blocksContainer" class="absolute inset-0 w-[720px] h-[360px] mx-auto my-auto pointer-events-auto"></div>
    </main>
    <footer class="bg-white px-3 py-2 border-t-2 border-slate-300">
      <div class="flex items-center justify-between gap-2 mb-2">
        <div class="flex items-center gap-1">
          <span class="text-xs text-slate-500 font-semibold">é¸æ“‡ï¼š</span>
          <span id="currentSelection" class="text-base font-extrabold text-blue-600">è«‹é»é¸å…ƒç´ </span>
        </div>
        <div class="flex items-center gap-1">
          <span class="text-xs text-slate-500 font-semibold">è¼¸å…¥ï¼š</span>
          <div id="inputDisplay" class="bg-slate-100 px-3 py-1 rounded-lg text-2xl font-mono font-bold tracking-[0.4em] min-w-[80px] text-center border-2 border-blue-200">_</div>
        </div>
      </div>
    </footer>
    <div class="virtual-keyboard" id="virtualKeyboard"></div>
  </div>
  <div id="aiModal" class="hidden fixed inset-0 bg-black/75 flex items-center justify-center z-50 px-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-5 relative">
      <button onclick="closeAiModal()" class="absolute top-2 right-3 text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
      <h3 class="text-lg font-bold text-blue-600 mb-3 flex items-center gap-2">ğŸ¤– AI å°è€å¸«</h3>
      <div id="aiContent" class="text-slate-700 text-sm leading-relaxed min-h-[80px] max-h-[50vh] overflow-y-auto"></div>
      <div id="aiLoading" class="hidden flex items-center justify-center gap-3 py-6">
        <div class="dot-flashing"></div>
        <span class="text-blue-600 text-sm font-semibold">å°è€å¸«æ­£åœ¨å¹«å¦³æƒ³â€¦</span>
      </div>
    </div>
  </div>
  <div id="winModal" class="hidden fixed inset-0 bg-blue-900/95 flex flex-col items-center justify-center z-50 text-white p-6">
    <div class="p-6 rounded-2xl bg-white/10 backdrop-blur-md text-center max-w-lg w-full border border-blue-200/40">
      <h2 class="text-4xl font-extrabold mb-4 text-yellow-300">ğŸ‰ ä»»å‹™å®Œæˆï¼</h2>
      <p class="text-lg mb-6">å…ƒç´ åŸå ¡å…¨éƒ¨æ‹¼å¥½å•¦ï¼</p>
      <div class="flex gap-3 justify-center">
        <a href="index.html" class="bg-yellow-400 hover:bg-yellow-500 text-blue-900 font-bold py-2 px-6 rounded-full shadow-lg">ğŸ  å›ä¸»é </a>
        <button onclick="location.reload()" class="bg-emerald-400 hover:bg-emerald-500 text-white font-bold py-2 px-6 rounded-full shadow-lg">ğŸ”„ å†ç©ä¸€æ¬¡</button>
      </div>
    </div>
  </div>
<script>
const elements = [
  {z:1,s:"H",n:"æ°«",r:1,c:1,color:"#f97373"},{z:2,s:"He",n:"æ°¦",r:1,c:18,color:"#38bdf8"},
  {z:3,s:"Li",n:"é‹°",r:2,c:1,color:"#fb923c"},{z:4,s:"Be",n:"éˆ¹",r:2,c:2,color:"#22c55e"},
  {z:6,s:"C",n:"ç¢³",r:2,c:14,color:"#6b7280"},{z:7,s:"N",n:"æ°®",r:2,c:15,color:"#f97373"},
  {z:8,s:"O",n:"æ°§",r:2,c:16,color:"#f97373"},{z:9,s:"F",n:"æ°Ÿ",r:2,c:17,color:"#facc15"},
  {z:10,s:"Ne",n:"æ°–",r:2,c:18,color:"#38bdf8"},{z:11,s:"Na",n:"éˆ‰",r:3,c:1,color:"#fb923c"},
  {z:12,s:"Mg",n:"é‚",r:3,c:2,color:"#22c55e"},{z:13,s:"Al",n:"é‹",r:3,c:13,color:"#a855f7"},
  {z:14,s:"Si",n:"çŸ½",r:3,c:14,color:"#8b5cf6"},{z:15,s:"P",n:"ç£·",r:3,c:15,color:"#facc15"},
  {z:16,s:"S",n:"ç¡«",r:3,c:16,color:"#facc15"},{z:17,s:"Cl",n:"æ°¯",r:3,c:17,color:"#facc15"},
  {z:18,s:"Ar",n:"æ°¬",r:3,c:18,color:"#38bdf8"},{z:19,s:"K",n:"é‰€",r:4,c:1,color:"#fb923c"},
  {z:20,s:"Ca",n:"éˆ£",r:4,c:2,color:"#22c55e"},{z:26,s:"Fe",n:"éµ",r:4,c:8,color:"#9ca3af"},
  {z:29,s:"Cu",n:"éŠ…",r:4,c:11,color:"#b45309"},{z:30,s:"Zn",n:"é‹…",r:4,c:12,color:"#9ca3af"},
  {z:35,s:"Br",n:"æº´",r:4,c:17,color:"#78350f"},{z:53,s:"I",n:"ç¢˜",r:5,c:17,color:"#5b21b6"}
];
let selectedElement=null, currentInput="", solvedCount=0;
const totalCount=elements.length;
let correctSynth, wrongSynth;

window.onload=()=>{
  setTimeout(()=>{initGrid();initBlocks();initAudio();initVirtualKeyboard();updateProgress();},50);
  document.addEventListener("keydown",handleGlobalKeydown);
};

function initAudio(){
  if(Tone.context.state!=="running"){
    const start=()=>{Tone.start().then(()=>{document.removeEventListener("touchstart",start);document.removeEventListener("mousedown",start);});};
    document.addEventListener("mousedown",start,{once:true});
    document.addEventListener("touchstart",start,{once:true});
  }
  correctSynth=new Tone.PolySynth(Tone.Synth,{oscillator:{type:"sine"},envelope:{attack:0.01,decay:0.2,sustain:0.1,release:0.4}}).toDestination();
  wrongSynth=new Tone.NoiseSynth({noise:{type:"pink"},envelope:{attack:0.005,decay:0.15,sustain:0,release:0.15}}).toDestination();
}
function playCorrect(){if(Tone.context.state==="running"&&correctSynth)correctSynth.triggerAttackRelease(["C5","E5","G5"],"8n");}
function playWrong(){if(Tone.context.state==="running"&&wrongSynth)wrongSynth.triggerAttackRelease("16n");}

function initGrid(){
  const grid=document.getElementById("ghostGrid");grid.innerHTML="";
  for(let r=1;r<=7;r++){for(let c=1;c<=18;c++){
    const cell=document.createElement("div");cell.className="grid-cell";cell.dataset.row=r;cell.dataset.col=c;
    const el=elements.find(e=>e.r===r&&e.c===c);
    if(el){cell.id=`slot-${el.s}`;cell.innerHTML=`<span class="z">${el.z}</span><span class="sym">${el.s}</span>`;}
    else if(r===6&&c>=3&&c<=10)cell.innerHTML="57â€“71";
    else if(r===7&&c>=3&&c<=10)cell.innerHTML="89â€“103";
    else cell.style.visibility="hidden";
    grid.appendChild(cell);
  }}
}

function initBlocks(){
  const container=document.getElementById("blocksContainer");container.innerHTML="";
  const cW=720,cH=360,pad=50;
  elements.forEach(el=>{
    const block=document.createElement("div");block.className="floating-block pointer-events-auto";
    block.id=`block-${el.s}`;block.style.backgroundColor=el.color;block.textContent=el.n;
    block.style.top=(Math.random()*(cH-pad*2)+pad)+"px";
    block.style.left=(Math.random()*(cW-pad*2)+pad)+"px";
    block.style.transform=`rotate(${Math.random()*30-15}deg)`;
    block.onclick=()=>selectBlock(el,block);
    block.ontouchend=(e)=>{e.preventDefault();selectBlock(el,block);};
    container.appendChild(block);
  });
}

function initVirtualKeyboard(){
  const kb=document.getElementById("virtualKeyboard");
  const keys=["Q","W","E","R","T","Y","U","I","O","P","A","S","D","F","G","H","J","K","L","âŒ«","Z","X","C","V","B","N","M","","","âœ“"];
  keys.forEach(k=>{
    if(k===""){const sp=document.createElement("div");kb.appendChild(sp);return;}
    const btn=document.createElement("button");btn.className="vk-key";btn.textContent=k;
    if(k==="âŒ«"){btn.classList.add("del");btn.onclick=()=>clearInput();}
    else if(k==="âœ“"){btn.classList.add("action");btn.textContent="ç¢ºèª";btn.onclick=()=>checkAnswer();}
    else btn.onclick=()=>handleKey(k);
    kb.appendChild(btn);
  });
}

function selectBlock(elData,blockDom){
  if(blockDom.classList.contains("solved"))return;
  document.querySelectorAll(".floating-block.selected").forEach(b=>b.classList.remove("selected"));
  selectedElement=elData;currentInput="";blockDom.classList.add("selected");
  const label=document.getElementById("currentSelection");label.textContent=elData.n;label.style.color=elData.color;
  updateInputDisplay();
}

function handleGlobalKeydown(e){
  if(!document.getElementById("aiModal").classList.contains("hidden"))return;
  if(!document.getElementById("winModal").classList.contains("hidden"))return;
  const k=e.key;
  if(k.length===1&&/[a-zA-Z]/.test(k)){e.preventDefault();handleKey(k.toUpperCase());}
  else if(k==="Backspace"||k==="Delete"){e.preventDefault();clearInput();}
  else if(k==="Enter"){e.preventDefault();checkAnswer();}
}

function handleKey(char){
  if(!selectedElement){document.getElementById("currentSelection").classList.add("shake");setTimeout(()=>document.getElementById("currentSelection").classList.remove("shake"),250);return;}
  const targetSym=selectedElement.s.toUpperCase();
  if(currentInput.length<targetSym.length){currentInput+=char;updateInputDisplay();}
  if(currentInput.length===targetSym.length&&targetSym.length===1)checkAnswer();
}

function checkAnswer(){
  if(!selectedElement)return;
  const targetSym=selectedElement.s.toUpperCase(),display=document.getElementById("inputDisplay");
  if(currentInput===targetSym){
    playCorrect();
    const block=document.getElementById(`block-${selectedElement.s}`),slot=document.getElementById(`slot-${selectedElement.s}`);
    const slotRect=slot.getBoundingClientRect(),containerRect=document.getElementById("blocksContainer").getBoundingClientRect();
    block.style.transform="rotate(0deg) scale(1)";
    block.style.left=(slotRect.left-containerRect.left)+"px";
    block.style.top=(slotRect.top-containerRect.top)+"px";
    block.style.width=slotRect.width+"px";block.style.height=slotRect.height+"px";
    block.classList.remove("selected");block.classList.add("solved");
    block.innerHTML=`<div class="flex flex-col items-center leading-none text-white"><span class="text-[8px] opacity-80">${selectedElement.z}</span><span class="text-sm">${selectedElement.s}</span></div>`;
    selectedElement=null;currentInput="";updateInputDisplay();
    document.getElementById("currentSelection").textContent="âœ… æ­¸ä½æˆåŠŸï¼";
    document.getElementById("currentSelection").style.color="#16a34a";
    solvedCount++;updateProgress();
    if(solvedCount===totalCount)setTimeout(()=>document.getElementById("winModal").classList.remove("hidden"),800);
  }else if(currentInput.length>0){
    playWrong();display.classList.add("shake","text-red-600");
    setTimeout(()=>{display.classList.remove("shake","text-red-600");currentInput="";updateInputDisplay();},350);
  }
}

function clearInput(){currentInput="";updateInputDisplay();}

function updateInputDisplay(){
  const display=document.getElementById("inputDisplay"),len=selectedElement?selectedElement.s.length:1;
  let show=currentInput.padEnd(len,"_");
  if(selectedElement){
    const t=selectedElement.s.toUpperCase();
    if(t.startsWith(currentInput)){display.classList.remove("text-red-500");display.classList.add("text-slate-800");}
    else{display.classList.add("text-red-500");display.classList.remove("text-slate-800");}
  }else{display.classList.remove("text-red-500","text-slate-800");display.classList.add("text-blue-600");}
  display.textContent=show.split("").join(" ");
}

function updateProgress(){document.getElementById("progressDisplay").textContent=`${solvedCount}/${totalCount}`;}

function askAIHint(){
  let target=selectedElement;
  if(!target){
    const unsolved=elements.filter(e=>{const b=document.getElementById(`block-${e.s}`);return b&&!b.classList.contains("solved");});
    if(unsolved.length===0){showAiModal("å¦³å·²ç¶“å…¨éƒ¨æ‹¼å¥½äº†ï¼å¤ªå¼·å•¦ï½ ğŸŒŸ",false);return;}
    target=unsolved[Math.floor(Math.random()*unsolved.length)];
    const b=document.getElementById(`block-${target.s}`);if(b)selectBlock(target,b);
  }
  showAiModal(`<p class="text-base leading-relaxed">ğŸ‘‹ å°æç¤ºä¾†å›‰ï¼<br><br>å¦³é¸åˆ°çš„å…ƒç´ æ˜¯ï¼š<strong class="text-blue-700 text-lg">${target.n}</strong><br>ä»–çš„åŸå­åºæ˜¯ï¼š<strong class="text-green-600 text-lg">${target.z}</strong><br><br>å†çœ‹ä¸€ä¸‹ä½ç½®ï¼Œå°±èƒ½æŠŠå®ƒæ”¾å›æ­£ç¢ºçš„åŸå ¡æˆ¿é–“å›‰ï¼</p>`,false);
}

function showAiModal(content,isLoading){
  const modal=document.getElementById("aiModal"),contentDiv=document.getElementById("aiContent"),loadingDiv=document.getElementById("aiLoading");
  modal.classList.remove("hidden");
  if(isLoading){contentDiv.classList.add("hidden");loadingDiv.classList.remove("hidden");contentDiv.innerHTML="";}
  else{contentDiv.classList.remove("hidden");loadingDiv.classList.add("hidden");contentDiv.innerHTML=content;}
}
function closeAiModal(){document.getElementById("aiModal").classList.add("hidden");}
</script>
</body>
</html>

    
