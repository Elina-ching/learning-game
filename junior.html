<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  <meta charset="UTF-8" />
Â  <meta
Â  Â  name="viewport"
Â  Â  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
Â  />
Â  <title>å…ƒç´ åŸå ¡æ‹¼æ‹¼æ¨‚ï½œåœ‹ä¸­ç‰ˆ</title>

Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
Â  Â  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>

Â  <style>
Â  Â  @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap");

Â  Â  body {
Â  Â  Â  font-family: "Noto Sans TC", sans-serif;
Â  Â  Â  background-color: #e0f2fe;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: center;
Â  Â  Â  touch-action: none;
Â  Â  Â  overflow: hidden;
Â  Â  }

Â  Â  #game-container {
Â  Â  Â  max-width: 960px;
Â  Â  Â  width: 100%;
Â  Â  Â  height: 100vh;
Â  Â  Â  background: #f9fafb;
Â  Â  Â  box-shadow: 0 0 25px rgba(15, 23, 42, 0.18);
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  }

Â  Â  /* ===== é€±æœŸè¡¨æ ¼å­ ===== */
Â  Â  .table-wrapper {
Â  Â  Â  position: relative;
Â  Â  Â  flex-grow: 1;
Â  Â  Â  overflow: auto;
Â  Â  Â  padding: 16px;
Â  Â  Â  background: radial-gradient(circle at top, #ffffff 0%, #dbeafe 45%, #bfdbfe 100%);
Â  Â  Â  border-bottom: 4px solid #93c5fd;
Â  Â  }

Â  Â  .periodic-grid {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(18, 1fr);
Â  Â  Â  grid-template-rows: repeat(7, 1fr);
Â  Â  Â  gap: 2px;
Â  Â  Â  width: 900px;
Â  Â  Â  height: 450px;
Â  Â  Â  pointer-events: none;
Â  Â  Â  position: absolute;
Â  Â  Â  inset: 0;
Â  Â  Â  margin: auto;
Â  Â  }

Â  Â  .grid-cell {
Â  Â  Â  border: 1px dashed rgba(148, 163, 184, 0.5);
Â  Â  Â  background-color: rgba(255, 255, 255, 0.7);
Â  Â  Â  border-radius: 4px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  font-size: 10px;
Â  Â  Â  color: #94a3b8;
Â  Â  Â  position: relative;
Â  Â  Â  transition: background-color 0.1s; /* è®“é–ƒçˆæ›´é †æš¢ */
Â  Â  }

Â  Â  .grid-cell span.z {
Â  Â  Â  position: absolute;
Â  Â  Â  top: 2px;
Â  Â  Â  left: 4px;
Â  Â  Â  font-size: 9px;
Â  Â  Â  opacity: 0.7;
Â  Â  }

Â  Â  .grid-cell span.sym {
Â  Â  Â  font-size: 14px;
Â  Â  Â  color: #cbd5f5;
Â  Â  }

Â  Â  /* æ–°å¢ï¼šæç¤ºé–ƒçˆå‹•ç•« */
Â  Â  @keyframes blink {
Â  Â  Â  0%, 100% {
Â  Â  Â  Â  background-color: rgba(255, 255, 255, 0.7);
Â  Â  Â  Â  box-shadow: 0 0 0 rgba(255, 255, 255, 0);
Â  Â  Â  }
Â  Â  Â  50% {
Â  Â  Â  Â  background-color: rgba(250, 204, 21, 0.6);
Â  Â  Â  Â  box-shadow: 0 0 10px rgba(250, 204, 21, 0.9);
Â  Â  Â  }
Â  Â  }

Â  Â  .blink {
Â  Â  Â  animation: blink 0.8s ease-in-out 3; /* é–ƒçˆ 3 æ¬¡ */
Â  Â  }

Â  Â  /* ===== æ¼‚æµ®å…ƒç´ å¡ç‰‡ ===== */
Â  Â  .floating-block {
Â  Â  Â  position: absolute;
Â  Â  Â  width: 52px;
Â  Â  Â  height: 52px;
Â  Â  Â  border-radius: 14px;
Â  Â  Â  display: flex;
Â  Â  Â  align-items: center;
Â  Â  Â  justify-content: center;
Â  Â  Â  font-weight: 700;
Â  Â  Â  font-size: 20px;
Â  Â  Â  color: #ffffff;
Â  Â  Â  box-shadow: 0 10px 16px rgba(15, 23, 42, 0.25);
Â  Â  Â  cursor: pointer;
Â  Â  Â  user-select: none;
Â  Â  Â  transition: transform 0.18s, box-shadow 0.18s,
Â  Â  Â  Â  top 0.6s cubic-bezier(0.34, 1.56, 0.64, 1),
Â  Â  Â  Â  left 0.6s cubic-bezier(0.34, 1.56, 0.64, 1),
Â  Â  Â  Â  width 0.3s ease, height 0.3s ease;
Â  Â  Â  z-index: 10;
Â  Â  }

Â  Â  .floating-block:active {
Â  Â  Â  transform: translateY(2px) scale(0.97);
Â  Â  Â  box-shadow: 0 6px 12px rgba(15, 23, 42, 0.18);
Â  Â  }

Â  Â  .floating-block.selected {
Â  Â  Â  border: 3px solid #facc15;
Â  Â  Â  box-shadow: 0 0 20px rgba(250, 204, 21, 0.95);
Â  Â  Â  transform: scale(1.16) rotate(0deg);
Â  Â  Â  z-index: 40;
Â  Â  }

Â  Â  .floating-block.solved {
Â  Â  Â  border-radius: 4px;
Â  Â  Â  box-shadow: inset 0 0 6px rgba(15, 23, 42, 0.35);
Â  Â  Â  pointer-events: none;
Â  Â  Â  z-index: 5;
Â  Â  }

Â  Â  /* ===== AI Loading dots (å·²ç§»é™¤ç›¸é—œå…§å®¹) ===== */

Â  Â  /* ===== shake éŒ¯èª¤å‹•ç•« ===== */
Â  Â  @keyframes shake {
Â  Â  Â  0%,
Â  Â  Â  100% {
Â  Â  Â  Â  transform: translateX(0);
Â  Â  Â  }
Â  Â  Â  20%,
Â  Â  Â  60% {
Â  Â  Â  Â  transform: translateX(-5px);
Â  Â  Â  }
Â  Â  Â  40%,
Â  Â  Â  80% {
Â  Â  Â  Â  transform: translateX(5px);
Â  Â  Â  }
Â  Â  }

Â  Â  .shake {
Â  Â  Â  animation: shake 0.24s ease-in-out;
Â  Â  }
Â  </style>
</head>
<body class="bg-sky-200">
Â  <div id="game-container">
Â  Â  Â  Â  <header
Â  Â  Â  class="bg-blue-600 text-white px-5 py-4 flex items-center justify-between shadow-md"
Â  Â  >
Â  Â  Â  <div>
Â  Â  Â  Â  <h1 class="text-xl md:text-2xl font-extrabold flex items-center gap-2">
Â  Â  Â  Â  Â  <span>ğŸ°</span>
Â  Â  Â  Â  Â  <span>å…ƒç´ åŸå ¡æ‹¼æ‹¼æ¨‚ï½œåœ‹ä¸­ç‰ˆ</span>
Â  Â  Â  Â  </h1>
Â  Â  Â  Â  <p class="text-xs md:text-sm text-blue-100 mt-1">
Â  Â  Â  Â  Â  æ±Ÿæ±Ÿèˆ‡é«˜æ‰‹æ”œæ‰‹æ‰“é€ ï½œåœ‹ä¸­ 108 èª²ç¶± 24 å€‹å…ƒç´ 
Â  Â  Â  Â  </p>
Â  Â  Â  Â  <p class="text-[11px] md:text-xs text-blue-100">
Â  Â  Â  Â  Â  é»é¸å…ƒç´  â†’ ç”¨éµç›¤è¼¸å…¥ç¬¦è™Ÿ â†’ æŒ‰ Enter ç¢ºèªï¼
Â  Â  Â  Â  </p>
Â  Â  Â  </div>

Â  Â  Â  <div class="text-right">
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  id="progressDisplay"
Â  Â  Â  Â  Â  class="text-3xl font-black tracking-tight drop-shadow-sm"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  0/24
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  onclick="askAIHint()"
Â  Â  Â  Â  Â  class="mt-2 inline-flex items-center gap-1 text-[11px] md:text-xs bg-yellow-300 text-blue-900 px-3 py-1.5 rounded-full font-bold shadow-lg hover:bg-yellow-200 active:scale-95 transition"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  ğŸ” æç¤º
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </header>

Â  Â  Â  Â  <main class="table-wrapper" id="tableArea">
Â  Â  Â  Â  Â  Â  <div class="periodic-grid" id="ghostGrid"></div>

Â  Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  id="blocksContainer"
Â  Â  Â  Â  class="absolute inset-0 w-[900px] h-[450px] mx-auto my-auto pointer-events-none"
Â  Â  Â  ></div>
Â  Â  </main>

Â  Â  Â  Â  <footer
Â  Â  Â  class="bg-white px-4 md:px-6 py-3 border-t-4 border-slate-300 flex flex-col md:flex-row items-center gap-3 md:gap-4"
Â  Â  >
Â  Â  Â  <div class="flex items-center gap-2 w-full md:w-auto">
Â  Â  Â  Â  <span class="text-sm md:text-base text-slate-500 font-semibold"
Â  Â  Â  Â  Â  >ç›®å‰é¸æ“‡ï¼š</span
Â  Â  Â  Â  >
Â  Â  Â  Â  <span
Â  Â  Â  Â  Â  id="currentSelection"
Â  Â  Â  Â  Â  class="text-xl md:text-2xl font-extrabold text-blue-600 transition-all duration-200"
Â  Â  Â  Â  Â  >è«‹é»é¸å…ƒç´ </span
Â  Â  Â  Â  >
Â  Â  Â  Â  <span
Â  Â  Â  Â  Â  id="hintMessage"
Â  Â  Â  Â  Â  class="text-xs text-yellow-600 font-bold hidden"
Â  Â  Â  Â  Â  >ğŸ’¡ è«‹çœ‹é€±æœŸè¡¨ä¸Šé–ƒçˆçš„ä½ç½®ï¼</span
Â  Â  Â  Â  >
Â  Â  Â  </div>

Â  Â  Â  <div
Â  Â  Â  Â  class="flex items-center gap-2 w-full md:w-auto justify-between md:justify-start"
Â  Â  Â  >
Â  Â  Â  Â  <span class="text-sm md:text-base text-slate-500 font-semibold"
Â  Â  Â  Â  Â  >è¼¸å…¥ï¼š</span
Â  Â  Â  Â  >
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  id="inputDisplay"
Â  Â  Â  Â  Â  class="bg-slate-100 px-5 py-2 rounded-xl text-3xl font-mono font-bold tracking-[0.6em] min-w-[120px] text-center border-4 border-blue-200 transition duration-100"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  _
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div
Â  Â  Â  Â  class="flex flex-1 justify-end gap-2 w-full md:w-auto mt-1 md:mt-0"
Â  Â  Â  >
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  onclick="clearInput()"
Â  Â  Â  Â  Â  class="flex-1 md:flex-none bg-red-500 hover:bg-red-600 active:scale-95 text-white text-xs md:text-sm font-bold py-2 px-4 rounded-full shadow-md transition inline-flex items-center justify-center gap-1"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  âŒ« æ¸…é™¤ (Backspace)
Â  Â  Â  Â  </button>
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  onclick="checkAnswer()"
Â  Â  Â  Â  Â  class="flex-1 md:flex-none bg-green-500 hover:bg-green-600 active:scale-95 text-white text-xs md:text-sm font-bold py-2 px-4 rounded-full shadow-md transition inline-flex items-center justify-center gap-1"
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  ç¢ºèª (Enter) âœ“
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </footer>
Â  </div>

Â  Â  <div
Â  Â  id="winModal"
Â  Â  class="hidden fixed inset-0 bg-blue-900/95 flex flex-col items-center justify-center z-50 text-white p-6"
Â  >
Â  Â  <div
Â  Â  Â  class="p-8 rounded-2xl bg-white/10 backdrop-blur-md text-center max-w-lg w-full border border-blue-200/40"
Â  Â  >
Â  Â  Â  <h2 class="text-5xl md:text-6xl font-extrabold mb-4 text-yellow-300">
Â  Â  Â  Â  ä»»å‹™å®Œæˆï¼
Â  Â  Â  </h2>
Â  Â  Â  <p class="text-xl md:text-2xl mb-8 font-light">
Â  Â  Â  Â  å…ƒç´ åŸå ¡å…¨éƒ¨æ‹¼å¥½å•¦ï¼Œå¦³çš„åŒ–å­¸ç‹åœ‹è¶…ç©©å›º ğŸ’ª
Â  Â  Â  </p>
Â  Â  Â  <button
Â  Â  Â  Â  onclick="location.reload()"
Â  Â  Â  Â  class="bg-emerald-400 hover:bg-emerald-500 active:scale-95 text-white font-bold py-3 px-9 rounded-full text-lg shadow-xl"
Â  Â  Â  >
Â  Â  Â  Â  å†ç©ä¸€æ¬¡
Â  Â  Â  </button>
Â  Â  </div>
Â  </div>
Â  <script>
Â  Â  // ===== 108 èª²ç¶± åœ‹ä¸­ 24 å€‹å…ƒç´  =====
Â  Â  const elements = [
Â  Â  Â  // Period 1
Â  Â  Â  { z: 1, s: "H", n: "æ°«", r: 1, c: 1, color: "#f97373" },
Â  Â  Â  { z: 2, s: "He", n: "æ°¦", r: 1, c: 18, color: "#38bdf8" },

Â  Â  Â  // Period 2
Â  Â  Â  { z: 3, s: "Li", n: "é‹°", r: 2, c: 1, color: "#fb923c" },
Â  Â  Â  { z: 4, s: "Be", n: "éˆ¹", r: 2, c: 2, color: "#22c55e" },
Â  Â  Â  { z: 6, s: "C", n: "ç¢³", r: 2, c: 14, color: "#6b7280" },
Â  Â  Â  { z: 7, s: "N", n: "æ°®", r: 2, c: 15, color: "#f97373" },
Â  Â  Â  { z: 8, s: "O", n: "æ°§", r: 2, c: 16, color: "#f97373" },
Â  Â  Â  { z: 9, s: "F", n: "æ°Ÿ", r: 2, c: 17, color: "#facc15" },
Â  Â  Â  { z: 10, s: "Ne", n: "æ°–", r: 2, c: 18, color: "#38bdf8" },

Â  Â  Â  // Period 3
Â  Â  Â  { z: 11, s: "Na", n: "éˆ‰", r: 3, c: 1, color: "#fb923c" },
Â  Â  Â  { z: 12, s: "Mg", n: "é‚", r: 3, c: 2, color: "#22c55e" },
Â  Â  Â  { z: 13, s: "Al", n: "é‹", r: 3, c: 13, color: "#a855f7" },
Â  Â  Â  { z: 14, s: "Si", n: "çŸ½", r: 3, c: 14, color: "#8b5cf6" },
Â  Â  Â  { z: 15, s: "P", n: "ç£·", r: 3, c: 15, color: "#facc15" },
Â  Â  Â  { z: 16, s: "S", n: "ç¡«", r: 3, c: 16, color: "#facc15" },
Â  Â  Â  { z: 17, s: "Cl", n: "æ°¯", r: 3, c: 17, color: "#facc15" },
Â  Â  Â  { z: 18, s: "Ar", n: "æ°¬", r: 3, c: 18, color: "#38bdf8" },

Â  Â  Â  // Period 4
Â  Â  Â  { z: 19, s: "K", n: "é‰€", r: 4, c: 1, color: "#fb923c" },
Â  Â  Â  { z: 20, s: "Ca", n: "éˆ£", r: 4, c: 2, color: "#22c55e" },
Â  Â  Â  { z: 26, s: "Fe", n: "éµ", r: 4, c: 8, color: "#9ca3af" },
Â  Â  Â  { z: 29, s: "Cu", n: "éŠ…", r: 4, c: 11, color: "#b45309" },
Â  Â  Â  { z: 30, s: "Zn", n: "é‹…", r: 4, c: 12, color: "#9ca3af" },
Â  Â  Â  { z: 35, s: "Br", n: "æº´", r: 4, c: 17, color: "#78350f" },
Â  Â  Â  { z: 53, s: "I", n: "ç¢˜", r: 5, c: 17, color: "#5b21b6" }
Â  Â  ];

Â  Â  // ===== éŠæˆ²ç‹€æ…‹ =====
Â  Â  let selectedElement = null;
Â  Â  let currentInput = "";
Â  Â  let solvedCount = 0;
Â  Â  const totalCount = elements.length;

Â  Â  let correctSynth, wrongSynth;

Â  Â  window.onload = () => {
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  initGrid();
Â  Â  Â  Â  initBlocks();
Â  Â  Â  Â  initAudio();
Â  Â  Â  Â  updateProgress();
Â  Â  Â  }, 50);

Â  Â  Â  document.addEventListener("keydown", handleGlobalKeydown);
Â  Â  };

Â  Â  // ===== éŸ³æ•ˆåˆå§‹åŒ– (ä¸è®Š) =====
Â  Â  function initAudio() {
Â  Â  Â  if (Tone.context.state !== "running") {
Â  Â  Â  Â  const startAudio = () => {
Â  Â  Â  Â  Â  Tone.start()
Â  Â  Â  Â  Â  Â  .then(() => {
Â  Â  Â  Â  Â  Â  Â  document.documentElement.removeEventListener(
Â  Â  Â  Â  Â  Â  Â  Â  "mousedown",
Â  Â  Â  Â  Â  Â  Â  Â  startAudio
Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  document.documentElement.removeEventListener(
Â  Â  Â  Â  Â  Â  Â  Â  "touchstart",
Â  Â  Â  Â  Â  Â  Â  Â  startAudio
Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  })
Â  Â  Â  Â  Â  Â  .catch((e) => console.error("Audio å•Ÿå‹•å¤±æ•—ï¼š", e));
Â  Â  Â  Â  };
Â  Â  Â  Â  document.documentElement.addEventListener("mousedown", startAudio, {
Â  Â  Â  Â  Â  once: true
Â  Â  Â  Â  });
Â  Â  Â  Â  document.documentElement.addEventListener("touchstart", startAudio, {
Â  Â  Â  Â  Â  once: true
Â  Â  Â  Â  });
Â  Â  Â  }

Â  Â  Â  correctSynth = new Tone.PolySynth(Tone.Synth, {
Â  Â  Â  Â  oscillator: { type: "sine" },
Â  Â  Â  Â  envelope: {
Â  Â  Â  Â  Â  attack: 0.01,
Â  Â  Â  Â  Â  decay: 0.2,
Â  Â  Â  Â  Â  sustain: 0.1,
Â  Â  Â  Â  Â  release: 0.4
Â  Â  Â  Â  }
Â  Â  Â  }).toDestination();

Â  Â  Â  wrongSynth = new Tone.NoiseSynth({
Â  Â  Â  Â  noise: { type: "pink" },
Â  Â  Â  Â  envelope: { attack: 0.005, decay: 0.15, sustain: 0, release: 0.15 }
Â  Â  Â  }).toDestination();
Â  Â  }

Â  Â  function playCorrect() {
Â  Â  Â  if (Tone.context.state === "running" && correctSynth) {
Â  Â  Â  Â  correctSynth.triggerAttackRelease(["C5", "E5", "G5"], "8n");
Â  Â  Â  }
Â  Â  }

Â  Â  function playWrong() {
Â  Â  Â  if (Tone.context.state === "running" && wrongSynth) {
Â  Â  Â  Â  wrongSynth.triggerAttackRelease("16n");
Â  Â  Â  }
Â  Â  }

Â  Â  // ===== å»ºç«‹èƒŒæ™¯æ ¼å­ (ä¸è®Š) =====
Â  Â  function initGrid() {
Â  Â  Â  const grid = document.getElementById("ghostGrid");
Â  Â  Â  grid.innerHTML = "";

Â  Â  Â  const gridWidth = 900;
Â  Â  Â  const gridHeight = 450;
Â  Â  Â  grid.style.width = gridWidth + "px";
Â  Â  Â  grid.style.height = gridHeight + "px";

Â  Â  Â  for (let r = 1; r <= 7; r++) {
Â  Â  Â  Â  for (let c = 1; c <= 18; c++) {
Â  Â  Â  Â  Â  const cell = document.createElement("div");
Â  Â  Â  Â  Â  cell.className = "grid-cell";
Â  Â  Â  Â  Â  cell.dataset.row = r;
Â  Â  Â  Â  Â  cell.dataset.col = c;

Â  Â  Â  Â  Â  const el = elements.find((e) => e.r === r && e.c === c);
Â  Â  Â  Â  Â  if (el) {
Â  Â  Â  Â  Â  Â  cell.id = `slot-${el.s}`;
Â  Â  Â  Â  Â  Â  cell.innerHTML = `
Â  Â  Â  Â  Â  Â  Â  <span class="z">${el.z}</span>
Â  Â  Â  Â  Â  Â  Â  <span class="sym">${el.s}</span>
Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  } else if (r === 6 && c >= 3 && c <= 10) {
Â  Â  Â  Â  Â  Â  cell.innerHTML = "57â€“71";
Â  Â  Â  Â  Â  } else if (r === 7 && c >= 3 && c <= 10) {
Â  Â  Â  Â  Â  Â  cell.innerHTML = "89â€“103";
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  cell.style.visibility = "hidden";
Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  grid.appendChild(cell);
Â  Â  Â  Â  }
Â  Â  Â  }

Â  Â  Â  const blockContainer = document.getElementById("blocksContainer");
Â  Â  Â  blockContainer.style.width = gridWidth + "px";
Â  Â  Â  blockContainer.style.height = gridHeight + "px";
Â  Â  }

Â  Â  // ===== å»ºç«‹é£„æµ®å…ƒç´ å¡ç‰‡ (ä¸è®Š) =====
Â  Â  function initBlocks() {
Â  Â  Â  const container = document.getElementById("blocksContainer");
Â  Â  Â  container.innerHTML = "";

Â  Â  Â  const containerWidth = 900;
Â  Â  Â  const containerHeight = 450;
Â  Â  Â  const padding = 60;

Â  Â  Â  elements.forEach((el) => {
Â  Â  Â  Â  const block = document.createElement("div");
Â  Â  Â  Â  block.className = "floating-block pointer-events-auto";
Â  Â  Â  Â  block.id = `block-${el.s}`;
Â  Â  Â  Â  block.style.backgroundColor = el.color;
Â  Â  Â  Â  block.textContent = el.n;

Â  Â  Â  Â  const randTop =
Â  Â  Â  Â  Â  Math.random() * (containerHeight - padding * 2) + padding;
Â  Â  Â  Â  const randLeft =
Â  Â  Â  Â  Â  Math.random() * (containerWidth - padding * 2) + padding;
Â  Â  Â  Â  const randRot = Math.random() * 30 - 15;

Â  Â  Â  Â  block.style.top = randTop + "px";
Â  Â  Â  Â  block.style.left = randLeft + "px";
Â  Â  Â  Â  block.style.transform = `rotate(${randRot}deg)`;

Â  Â  Â  Â  block.onclick = () => selectBlock(el, block);
Â  Â  Â  Â  container.appendChild(block);
Â  Â  Â  });
Â  Â  }

Â  Â  // ===== é¸æ“‡å¡ç‰‡ (ä¸è®Š) =====
Â  Â  function selectBlock(elData, blockDom) {
Â  Â  Â  if (blockDom.classList.contains("solved")) return;

Â  Â  Â  document
Â  Â  Â  Â  .querySelectorAll(".floating-block.selected")
Â  Â  Â  Â  .forEach((b) => b.classList.remove("selected"));

Â  Â  Â  selectedElement = elData;
Â  Â  Â  currentInput = "";
Â  Â  Â  blockDom.classList.add("selected");

Â  Â  Â  const label = document.getElementById("currentSelection");
Â  Â  Â  label.textContent = `${elData.n} (${elData.z})`;
Â  Â  Â  label.style.color = elData.color;

Â  Â  Â  // éš±è—æç¤ºè¨Šæ¯
Â  Â  Â  document.getElementById("hintMessage").classList.add("hidden");

Â  Â  Â  updateInputDisplay();

Â  Â  Â  const tableWrapper = document.getElementById("tableArea");
Â  Â  Â  const blockRect = blockDom.getBoundingClientRect();
Â  Â  Â  const wrapperRect = tableWrapper.getBoundingClientRect();

Â  Â  Â  const scrollLeft =
Â  Â  Â  Â  blockRect.left -
Â  Â  Â  Â  wrapperRect.left +
Â  Â  Â  Â  tableWrapper.scrollLeft -
Â  Â  Â  Â  wrapperRect.width / 2 +
Â  Â  Â  Â  blockRect.width / 2;
Â  Â  Â  const scrollTop =
Â  Â  Â  Â  blockRect.top -
Â  Â  Â  Â  wrapperRect.top +
Â  Â  Â  Â  tableWrapper.scrollTop -
Â  Â  Â  Â  wrapperRect.height / 2 +
Â  Â  Â  Â  blockRect.height / 2;

Â  Â  Â  tableWrapper.scrollTo({
Â  Â  Â  Â  left: scrollLeft,
Â  Â  Â  Â  top: scrollTop,
Â  Â  Â  Â  behavior: "smooth"
Â  Â  Â  });
Â  Â  }

Â  Â  // ===== éµç›¤äº‹ä»¶ (èª¿æ•´ï¼ŒæŠŠ AI Modal åˆ¤æ–·æ‹¿æ‰) =====
Â  Â  function handleGlobalKeydown(event) {
Â  Â  Â  if (!document.getElementById("winModal").classList.contains("hidden")) {
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const key = event.key;

Â  Â  Â  if (key.length === 1 && /[a-zA-Z]/.test(key)) {
Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  handleKey(key.toUpperCase());
Â  Â  Â  } else if (key === "Backspace" || key === "Delete") {
Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  clearInput();
Â  Â  Â  } else if (key === "Enter") {
Â  Â  Â  Â  event.preventDefault();
Â  Â  Â  Â  checkAnswer();
Â  Â  Â  }
Â  Â  }

Â  Â  function handleKey(char) {
Â  Â  Â  if (!selectedElement) {
Â  Â  Â  Â  const label = document.getElementById("currentSelection");
Â  Â  Â  Â  label.classList.add("shake");
Â  Â  Â  Â  setTimeout(() => label.classList.remove("shake"), 250);
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const targetSym = selectedElement.s.toUpperCase();

Â  Â  Â  if (currentInput.length < targetSym.length) {
Â  Â  Â  Â  currentInput += char;
Â  Â  Â  Â  updateInputDisplay();
Â  Â  Â  }

Â  Â  Â  if (
Â  Â  Â  Â  currentInput.length === targetSym.length &&
Â  Â  Â  Â  targetSym.length === 1
Â  Â  Â  ) {
Â  Â  Â  Â  checkAnswer();
Â  Â  Â  }
Â  Â  }

Â  Â  // ===== æª¢æŸ¥ç­”æ¡ˆ (ä¸è®Š) =====
Â  Â  function checkAnswer() {
Â  Â  Â  if (!selectedElement) return;

Â  Â  Â  const targetSym = selectedElement.s.toUpperCase();
Â  Â  Â  const display = document.getElementById("inputDisplay");
Â  Â  Â  document.getElementById("hintMessage").classList.add("hidden");


Â  Â  Â  if (currentInput === targetSym) {
Â  Â  Â  Â  playCorrect();

Â  Â  Â  Â  const block = document.getElementById(`block-${selectedElement.s}`);
Â  Â  Â  Â  const slot = document.getElementById(`slot-${selectedElement.s}`);

Â  Â  Â  Â  const slotRect = slot.getBoundingClientRect();
Â  Â  Â  Â  const containerRect =
Â  Â  Â  Â  Â  document.getElementById("blocksContainer").getBoundingClientRect();

Â  Â  Â  Â  const targetLeft = slotRect.left - containerRect.left;
Â  Â  Â  Â  const targetTop = slotRect.top - containerRect.top;

Â  Â  Â  Â  block.style.transform = "rotate(0deg) scale(1)";
Â  Â  Â  Â  block.style.left = targetLeft + "px";
Â  Â  Â  Â  block.style.top = targetTop + "px";
Â  Â  Â  Â  block.style.width = slotRect.width + "px";
Â  Â  Â  Â  block.style.height = slotRect.height + "px";

Â  Â  Â  Â  block.classList.remove("selected");
Â  Â  Â  Â  block.classList.add("solved");

Â  Â  Â  Â  block.innerHTML = `
Â  Â  Â  Â  Â  <div class="flex flex-col items-center leading-none text-white">
Â  Â  Â  Â  Â  Â  <span class="text-[10px] opacity-80">${selectedElement.z}</span>
Â  Â  Â  Â  Â  Â  <span class="text-lg">${selectedElement.s}</span>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  `;

Â  Â  Â  Â  selectedElement = null;
Â  Â  Â  Â  currentInput = "";
Â  Â  Â  Â  updateInputDisplay();

Â  Â  Â  Â  const label = document.getElementById("currentSelection");
Â  Â  Â  Â  label.textContent = "âœ… æ­¸ä½æˆåŠŸï¼å†é¸ä¸€å€‹å§ï½";
Â  Â  Â  Â  label.style.color = "#16a34a";

Â  Â  Â  Â  solvedCount++;
Â  Â  Â  Â  updateProgress();

Â  Â  Â  Â  if (solvedCount === totalCount) {
Â  Â  Â  Â  Â  setTimeout(
Â  Â  Â  Â  Â  Â  () =>
Â  Â  Â  Â  Â  Â  Â  document
Â  Â  Â  Â  Â  Â  Â  Â  .getElementById("winModal")
Â  Â  Â  Â  Â  Â  Â  Â  .classList.remove("hidden"),
Â  Â  Â  Â  Â  Â  800
Â  Â  Â  Â  Â  );
Â  Â  Â  Â  }
Â  Â  Â  } else if (currentInput.length > 0) {
Â  Â  Â  Â  playWrong();
Â  Â  Â  Â  display.classList.add("shake", "text-red-600");

Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  display.classList.remove("shake", "text-red-600");
Â  Â  Â  Â  Â  currentInput = "";
Â  Â  Â  Â  Â  updateInputDisplay();
Â  Â  Â  Â  }, 350);
Â  Â  Â  }
Â  Â  }

Â  Â  function clearInput() {
Â  Â  Â  currentInput = "";
Â  Â  Â  updateInputDisplay();
Â  Â  }

Â  Â  function updateInputDisplay() {
Â  Â  Â  const display = document.getElementById("inputDisplay");
Â  Â  Â  const len = selectedElement ? selectedElement.s.length : 1;
Â  Â  Â  let show = currentInput.padEnd(len, "_");

Â  Â  Â  if (selectedElement) {
Â  Â  Â  Â  const targetSym = selectedElement.s.toUpperCase();
Â  Â  Â  Â  if (targetSym.startsWith(currentInput)) {
Â  Â  Â  Â  Â  display.classList.remove("text-red-500");
Â  Â  Â  Â  Â  display.classList.add("text-slate-800");
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  display.classList.add("text-red-500");
Â  Â  Â  Â  Â  display.classList.remove("text-slate-800");
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  display.classList.remove("text-red-500", "text-slate-800");
Â  Â  Â  Â  display.classList.add("text-blue-600");
Â  Â  Â  }

Â  Â  Â  display.textContent = show.split("").join(" ");
Â  Â  }

Â  Â  function updateProgress() {
Â  Â  Â  document.getElementById(
Â  Â  Â  Â  "progressDisplay"
Â  Â  Â  ).textContent = `${solvedCount}/${totalCount}`;
Â  Â  }

Â  Â  // ===== æ–°çš„æç¤ºåŠŸèƒ½ï¼šé–ƒçˆæ ¼å­ =====
Â  Â  function askAIHint() {
Â  Â  Â  let target = selectedElement;

Â  Â  Â  // 1. å¦‚æœæ²’æœ‰é¸ï¼Œå°±éš¨æ©Ÿé¸ä¸€å€‹é‚„æ²’è§£çš„
Â  Â  Â  if (!target) {
Â  Â  Â  Â  const unsolved = elements.filter((e) => {
Â  Â  Â  Â  Â  const b = document.getElementById(`block-${e.s}`);
Â  Â  Â  Â  Â  return b && !b.classList.contains("solved");
Â  Â  Â  Â  });
Â  Â  Â  Â  if (unsolved.length === 0) {
Â  Â  Â  Â  Â  // å…¨éƒ¨è§£å®Œäº†
Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  target = unsolved[Math.floor(Math.random() * unsolved.length)];
Â  Â  Â  Â  const b = document.getElementById(`block-${target.s}`);
Â  Â  Â  Â  if (b) selectBlock(target, b); // å¼·åˆ¶é¸ä¸­é€™å€‹å…ƒç´ 
Â  Â  Â  }

Â  Â  Â  // 2. æ‰¾åˆ°å°æ‡‰çš„æ ¼å­ä¸¦è®“å®ƒé–ƒçˆ
Â  Â  Â  const slot = document.getElementById(`slot-${target.s}`);
Â  Â  Â  if (slot) {
Â  Â  Â  Â  // é¡¯ç¤ºæç¤ºæ–‡å­—
Â  Â  Â  Â  document.getElementById("hintMessage").classList.remove("hidden");

Â  Â  Â  Â  // å…ˆç§»é™¤èˆŠçš„å‹•ç•«ï¼Œå†é‡æ–°åŠ å…¥
Â  Â  Â  Â  slot.classList.remove("blink");
Â  Â  Â  Â  // éœ€è¦ä¸€é»æ™‚é–“è®“ç€è¦½å™¨é‡ç¹ªï¼Œæ‰èƒ½é‡æ–°è§¸ç™¼å‹•ç•«
Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  slot.classList.add("blink");
Â  Â  Â  Â  Â  // é–ƒçˆå®Œå¾Œç§»é™¤ class å’Œæç¤ºæ–‡å­—
Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  slot.classList.remove("blink");
Â  Â  Â  Â  Â  Â  document.getElementById("hintMessage").classList.add("hidden");
Â  Â  Â  Â  Â  }, 2500); // é–ƒçˆ 3 æ¬¡ç´„ 2.4 ç§’
Â  Â  Â  Â  }, 10);
Â  Â  Â  }
Â  Â  }
Â  </script>
</body>
</html>
