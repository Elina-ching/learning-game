<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>å…ƒç´ åŸå ¡æ‹¼æ‹¼æ¨‚ï½œé«˜ä¸­ç‰ˆ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
  <style>
    @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap");
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body {
      font-family: "Noto Sans TC", sans-serif;
      background-color: #e0f2fe;
      margin: 0; padding: 0;
      display: flex; justify-content: center;
      touch-action: manipulation;
      overflow: hidden;
      position: fixed; width: 100%; height: 100%;
    }
    #game-container {
      max-width: 960px; width: 100%; height: 100%;
      background: #f9fafb;
      box-shadow: 0 0 25px rgba(15,23,42,0.18);
      display: flex; flex-direction: column;
    }
    .table-wrapper {
      position: relative; flex-grow: 1;
      overflow: auto; -webkit-overflow-scrolling: touch;
      padding: 8px;
      background: radial-gradient(circle at top, #ffffff 0%, #dbeafe 45%, #bfdbfe 100%);
      border-bottom: 4px solid #93c5fd;
    }
    .periodic-grid {
      display: grid;
      grid-template-columns: repeat(18, 1fr);
      grid-template-rows: repeat(7, 1fr);
      gap: 2px;
      width: 720px; height: 360px;
      pointer-events: none;
      position: absolute; inset: 0; margin: auto;
    }
    .grid-cell {
      border: 1px dashed rgba(148,163,184,0.5);
      background-color: rgba(255,255,255,0.7);
      border-radius: 4px;
      display: flex; align-items: center; justify-content: center;
      font-size: 8px; color: #94a3b8;
      position: relative;
    }
    .grid-cell span.z { position: absolute; top: 1px; left: 2px; font-size: 7px; opacity: 0.7; }
    .grid-cell span.sym { font-size: 11px; color: #cbd5f5; }
    .floating-block {
      position: absolute;
      width: 38px; height: 38px;
      border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
      font-weight: 700; font-size: 14px; color: #fff;
      box-shadow: 0 6px 12px rgba(15,23,42,0.25);
      cursor: pointer; user-select: none;
      transition: transform 0.18s, box-shadow 0.18s,
        top 0.5s cubic-bezier(0.34,1.56,0.64,1),
        left 0.5s cubic-bezier(0.34,1.56,0.64,1),
        width 0.3s ease, height 0.3s ease;
      z-index: 10;
    }
    .floating-block:active { transform: translateY(2px) scale(0.97); box-shadow: 0 4px 10px rgba(15,23,42,0.18); }
    .floating-block.selected {
      border: 3px solid #facc15;
      box-shadow: 0 0 18px rgba(250,204,21,0.95);
      transform: scale(1.14); z-index: 40;
    }
    .floating-block.solved {
      border-radius: 4px;
      box-shadow: inset 0 0 6px rgba(15,23,42,0.35);
      pointer-events: none; z-index: 5;
    }
    #mainInput {
      background: #f1f5f9; border: 3px solid #3b82f6;
      border-radius: 12px; padding: 8px 16px;
      font-size: 28px; font-family: monospace; font-weight: 700;
      letter-spacing: 0.5em; text-align: center;
      min-width: 100px; max-width: 140px;
      color: #1e293b; caret-color: #3b82f6;
      text-transform: uppercase;
    }
    #mainInput:focus { outline: none; border-color: #facc15; box-shadow: 0 0 12px rgba(250,204,21,0.5); }
    #mainInput::placeholder { color: #94a3b8; letter-spacing: 0.3em; }
    @keyframes shake { 0%,100%{transform:translateX(0)} 20%,60%{transform:translateX(-5px)} 40%,80%{transform:translateX(5px)} }
    .shake { animation: shake 0.24s ease-in-out; }
    .dot-flashing {
      position: relative; width: 10px; height: 10px;
      border-radius: 999px; background-color: #2563eb;
      animation: dot-flashing 1s infinite linear alternate; animation-delay: 0.5s;
    }
    .dot-flashing::before, .dot-flashing::after {
      content: ""; position: absolute; top: 0;
      width: 10px; height: 10px; border-radius: 999px; background-color: #2563eb;
    }
    .dot-flashing::before { left: -15px; animation: dot-flashing 1s infinite alternate; animation-delay: 0s; }
    .dot-flashing::after { left: 15px; animation: dot-flashing 1s infinite alternate; animation-delay: 1s; }
    @keyframes dot-flashing { 0%{background-color:#2563eb} 50%,100%{background-color:rgba(37,99,235,0.2)} }
    @media (max-width: 600px) {
      .periodic-grid, #blocksContainer { width: 540px; height: 270px; }
      .floating-block { width: 28px; height: 28px; font-size: 10px; border-radius: 6px; }
      #mainInput { font-size: 22px; padding: 6px 12px; min-width: 80px; }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <header class="bg-indigo-600 text-white px-4 py-3 flex items-center justify-between shadow-md">
      <div>
        <h1 class="text-lg font-extrabold flex items-center gap-1">ğŸ° å…ƒç´ åŸå ¡æ‹¼æ‹¼æ¨‚ï½œé«˜ä¸­ç‰ˆ</h1>
        <p class="text-[10px] text-indigo-100">é»é¸å…ƒç´  â†’ è¼¸å…¥ç¬¦è™Ÿ â†’ Enterç¢ºèªï¼</p>
      </div>
      <div class="text-right flex items-center gap-2">
        <div id="progressDisplay" class="text-2xl font-black">0/65</div>
        <button onclick="askAIHint()" class="text-[10px] bg-yellow-300 text-indigo-900 px-2 py-1 rounded-full font-bold shadow">âœ¨æç¤º</button>
      </div>
    </header>
    <main class="table-wrapper" id="tableArea">
      <div class="periodic-grid" id="ghostGrid"></div>
      <div id="blocksContainer" class="absolute inset-0 w-[720px] h-[360px] mx-auto my-auto pointer-events-auto"></div>
    </main>
    <footer class="bg-white px-3 py-3 border-t-2 border-slate-300">
      <div class="flex flex-wrap items-center justify-center gap-3">
        <div class="flex items-center gap-2">
          <span class="text-sm text-slate-500 font-semibold">é¸æ“‡ï¼š</span>
          <span id="currentSelection" class="text-lg font-extrabold text-indigo-600">è«‹é»é¸å…ƒç´ </span>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-sm text-slate-500 font-semibold">è¼¸å…¥ï¼š</span>
          <input type="text" id="mainInput" placeholder="_" maxlength="2" autocomplete="off" autocapitalize="characters" autocorrect="off" spellcheck="false" />
        </div>
        <div class="flex gap-2">
          <button onclick="clearInput()" class="bg-red-500 hover:bg-red-600 active:scale-95 text-white text-xs font-bold py-2 px-3 rounded-full shadow transition">âŒ« æ¸…é™¤</button>
          <button onclick="checkAnswer()" class="bg-green-500 hover:bg-green-600 active:scale-95 text-white text-xs font-bold py-2 px-3 rounded-full shadow transition">âœ“ ç¢ºèª</button>
          <a href="index.html" class="bg-yellow-400 hover:bg-yellow-500 active:scale-95 text-yellow-900 text-xs font-bold py-2 px-3 rounded-full shadow transition flex items-center gap-1" title="å›ä¸»é "><svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></a>
        </div>
      </div>
      <p class="text-center text-[10px] text-slate-400 mt-2">ğŸ’¡ é›»è…¦ï¼šç›´æ¥æ‰“å­— + Enter ï½œ æ‰‹æ©Ÿ/å¹³æ¿ï¼šé»è¼¸å…¥æ¡†å«å‡ºéµç›¤</p>
    </footer>
  </div>
  <div id="aiModal" class="hidden fixed inset-0 bg-black/75 flex items-center justify-center z-50 px-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full p-5 relative">
      <button onclick="closeAiModal()" class="absolute top-2 right-3 text-slate-400 hover:text-slate-600 text-2xl">&times;</button>
      <h3 class="text-lg font-bold text-indigo-600 mb-3 flex items-center gap-2">ğŸ§ª é«˜æ‰‹å°æé†’</h3>
      <div id="aiContent" class="text-slate-700 text-sm leading-relaxed min-h-[80px] max-h-[50vh] overflow-y-auto"></div>
    </div>
  </div>
  <div id="winModal" class="hidden fixed inset-0 bg-indigo-900/95 flex flex-col items-center justify-center z-50 text-white p-6">
    <div class="p-6 rounded-2xl bg-white/10 backdrop-blur-md text-center max-w-lg w-full border border-indigo-200/40">
      <h2 class="text-4xl font-extrabold mb-4 text-yellow-300">ğŸ‰ ä»»å‹™å®Œæˆï¼</h2>
      <p class="text-lg mb-6">é«˜ä¸­ç‰ˆå…ƒç´ åŸå ¡æ‹¼å¥½å•¦ï¼ŒåŒ–å­¸åº•å­è¶…æ‰å¯¦ï¼</p>
      <div class="flex gap-3 justify-center">
        <a href="index.html" class="bg-yellow-400 hover:bg-yellow-500 text-indigo-900 font-bold py-2 px-6 rounded-full shadow-lg">ğŸ  å›ä¸»é </a>
        <button onclick="location.reload()" class="bg-emerald-400 hover:bg-emerald-500 text-white font-bold py-2 px-6 rounded-full shadow-lg">ğŸ”„ å†ç©ä¸€æ¬¡</button>
      </div>
    </div>
  </div>
<script>
const elements = [
  {z:1,s:"H",n:"æ°«",r:1,c:1,color:"#f97373"},{z:2,s:"He",n:"æ°¦",r:1,c:18,color:"#38bdf8"},
  {z:3,s:"Li",n:"é‹°",r:2,c:1,color:"#fb923c"},{z:4,s:"Be",n:"éˆ¹",r:2,c:2,color:"#22c55e"},
  {z:5,s:"B",n:"ç¡¼",r:2,c:13,color:"#8b5cf6"},{z:6,s:"C",n:"ç¢³",r:2,c:14,color:"#6b7280"},
  {z:7,s:"N",n:"æ°®",r:2,c:15,color:"#f97373"},{z:8,s:"O",n:"æ°§",r:2,c:16,color:"#f97373"},
  {z:9,s:"F",n:"æ°Ÿ",r:2,c:17,color:"#facc15"},{z:10,s:"Ne",n:"æ°–",r:2,c:18,color:"#38bdf8"},
  {z:11,s:"Na",n:"éˆ‰",r:3,c:1,color:"#fb923c"},{z:12,s:"Mg",n:"é‚",r:3,c:2,color:"#22c55e"},
  {z:13,s:"Al",n:"é‹",r:3,c:13,color:"#a855f7"},{z:14,s:"Si",n:"çŸ½",r:3,c:14,color:"#8b5cf6"},
  {z:15,s:"P",n:"ç£·",r:3,c:15,color:"#facc15"},{z:16,s:"S",n:"ç¡«",r:3,c:16,color:"#facc15"},
  {z:17,s:"Cl",n:"æ°¯",r:3,c:17,color:"#facc15"},{z:18,s:"Ar",n:"æ°¬",r:3,c:18,color:"#38bdf8"},
  {z:19,s:"K",n:"é‰€",r:4,c:1,color:"#fb923c"},{z:20,s:"Ca",n:"éˆ£",r:4,c:2,color:"#22c55e"},
  {z:21,s:"Sc",n:"éˆ§",r:4,c:3,color:"#9ca3af"},{z:22,s:"Ti",n:"éˆ¦",r:4,c:4,color:"#9ca3af"},
  {z:23,s:"V",n:"é‡©",r:4,c:5,color:"#9ca3af"},{z:24,s:"Cr",n:"é‰»",r:4,c:6,color:"#9ca3af"},
  {z:25,s:"Mn",n:"éŒ³",r:4,c:7,color:"#9ca3af"},{z:26,s:"Fe",n:"éµ",r:4,c:8,color:"#9ca3af"},
  {z:27,s:"Co",n:"éˆ·",r:4,c:9,color:"#9ca3af"},{z:28,s:"Ni",n:"é³",r:4,c:10,color:"#9ca3af"},
  {z:29,s:"Cu",n:"éŠ…",r:4,c:11,color:"#b45309"},{z:30,s:"Zn",n:"é‹…",r:4,c:12,color:"#9ca3af"},
  {z:31,s:"Ga",n:"éµ",r:4,c:13,color:"#a855f7"},{z:32,s:"Ge",n:"éº",r:4,c:14,color:"#8b5cf6"},
  {z:33,s:"As",n:"ç ·",r:4,c:15,color:"#facc15"},{z:34,s:"Se",n:"ç¡’",r:4,c:16,color:"#facc15"},
  {z:35,s:"Br",n:"æº´",r:4,c:17,color:"#f97316"},{z:36,s:"Kr",n:"æ°ª",r:4,c:18,color:"#38bdf8"},
  {z:37,s:"Rb",n:"éŠ£",r:5,c:1,color:"#fb923c"},{z:38,s:"Sr",n:"é¶",r:5,c:2,color:"#22c55e"},
  {z:39,s:"Y",n:"é‡”",r:5,c:3,color:"#9ca3af"},{z:40,s:"Zr",n:"é‹¯",r:5,c:4,color:"#9ca3af"},
  {z:41,s:"Nb",n:"éˆ®",r:5,c:5,color:"#9ca3af"},{z:42,s:"Mo",n:"é‰¬",r:5,c:6,color:"#9ca3af"},
  {z:44,s:"Ru",n:"é‡•",r:5,c:8,color:"#9ca3af"},{z:45,s:"Rh",n:"éŠ ",r:5,c:9,color:"#9ca3af"},
  {z:46,s:"Pd",n:"éˆ€",r:5,c:10,color:"#9ca3af"},{z:47,s:"Ag",n:"éŠ€",r:5,c:11,color:"#b45309"},
  {z:48,s:"Cd",n:"é˜",r:5,c:12,color:"#9ca3af"},{z:49,s:"In",n:"éŠ¦",r:5,c:13,color:"#a855f7"},
  {z:50,s:"Sn",n:"éŒ«",r:5,c:14,color:"#a855f7"},{z:51,s:"Sb",n:"éŠ»",r:5,c:15,color:"#facc15"},
  {z:52,s:"Te",n:"ç¢²",r:5,c:16,color:"#facc15"},{z:53,s:"I",n:"ç¢˜",r:5,c:17,color:"#f97316"},
  {z:54,s:"Xe",n:"æ°™",r:5,c:18,color:"#38bdf8"},{z:55,s:"Cs",n:"éŠ«",r:6,c:1,color:"#fb923c"},
  {z:56,s:"Ba",n:"é‹‡",r:6,c:2,color:"#22c55e"},{z:72,s:"Hf",n:"é‰¿",r:6,c:4,color:"#9ca3af"},
  {z:73,s:"Ta",n:"é‰­",r:6,c:5,color:"#9ca3af"},{z:74,s:"W",n:"é¢",r:6,c:6,color:"#9ca3af"},
  {z:75,s:"Re",n:"éŒ¸",r:6,c:7,color:"#9ca3af"},{z:76,s:"Os",n:"é‹¨",r:6,c:8,color:"#9ca3af"},
  {z:77,s:"Ir",n:"éŠ¥",r:6,c:9,color:"#9ca3af"},{z:78,s:"Pt",n:"é‰‘",r:6,c:10,color:"#9ca3af"},
  {z:79,s:"Au",n:"é‡‘",r:6,c:11,color:"#b45309"},{z:80,s:"Hg",n:"æ±",r:6,c:12,color:"#9ca3af"},
  {z:82,s:"Pb",n:"é‰›",r:6,c:14,color:"#a855f7"}
];
let selectedElement=null, solvedCount=0;
const totalCount=elements.length;
let correctSynth, wrongSynth;
const mainInput = document.getElementById("mainInput");

window.onload=()=>{
  setTimeout(()=>{initGrid();initBlocks();initAudio();updateProgress();},50);
};

mainInput.addEventListener("input", (e) => {
  let val = e.target.value.toUpperCase().replace(/[^A-Z]/g, "");
  if (selectedElement) val = val.slice(0, selectedElement.s.length);
  else val = val.slice(0, 2);
  e.target.value = val;
  if (selectedElement && selectedElement.s.length === 1 && val.length === 1) checkAnswer();
});

mainInput.addEventListener("keydown", (e) => {
  if (e.key === "Enter") { e.preventDefault(); checkAnswer(); }
});

document.addEventListener("keydown", (e) => {
  if (document.activeElement === mainInput) return;
  if (!document.getElementById("aiModal").classList.contains("hidden")) return;
  if (!document.getElementById("winModal").classList.contains("hidden")) return;
  const k = e.key;
  if (k.length === 1 && /[a-zA-Z]/.test(k)) {
    e.preventDefault(); mainInput.focus();
    mainInput.value += k.toUpperCase();
    mainInput.dispatchEvent(new Event("input"));
  } else if (k === "Backspace" || k === "Delete") { e.preventDefault(); clearInput(); }
  else if (k === "Enter") { e.preventDefault(); checkAnswer(); }
});

function initAudio(){
  if(Tone.context.state!=="running"){
    const start=()=>{Tone.start().then(()=>{document.removeEventListener("touchstart",start);document.removeEventListener("mousedown",start);});};
    document.addEventListener("mousedown",start,{once:true});
    document.addEventListener("touchstart",start,{once:true});
  }
  correctSynth=new Tone.PolySynth(Tone.Synth,{oscillator:{type:"sine"},envelope:{attack:0.01,decay:0.2,sustain:0.1,release:0.4}}).toDestination();
  wrongSynth=new Tone.NoiseSynth({noise:{type:"pink"},envelope:{attack:0.005,decay:0.15,sustain:0,release:0.15}}).toDestination();
}
function playCorrect(){if(Tone.context.state==="running"&&correctSynth)correctSynth.triggerAttackRelease(["C5","E5","G5"],"8n");}
function playWrong(){if(Tone.context.state==="running"&&wrongSynth)wrongSynth.triggerAttackRelease("16n");}

function initGrid(){
  const grid=document.getElementById("ghostGrid");grid.innerHTML="";
  for(let r=1;r<=7;r++){for(let c=1;c<=18;c++){
    const cell=document.createElement("div");cell.className="grid-cell";
    const el=elements.find(e=>e.r===r&&e.c===c);
    if(el){cell.id=`slot-${el.s}`;cell.innerHTML=`<span class="z">${el.z}</span><span class="sym">${el.s}</span>`;}
    else if(r===6&&c===3)cell.innerHTML="57â€“71";
    else if(r===7&&c>=3&&c<=10)cell.innerHTML="89â€“103";
    else cell.style.visibility="hidden";
    grid.appendChild(cell);
  }}
}

function initBlocks(){
  const container=document.getElementById("blocksContainer");container.innerHTML="";
  const cW=720,cH=360,pad=40;
  elements.forEach(el=>{
    const block=document.createElement("div");block.className="floating-block pointer-events-auto";
    block.id=`block-${el.s}`;block.style.backgroundColor=el.color;block.textContent=el.n;
    block.style.top=(Math.random()*(cH-pad*2)+pad)+"px";
    block.style.left=(Math.random()*(cW-pad*2)+pad)+"px";
    block.style.transform=`rotate(${Math.random()*30-15}deg)`;
    block.addEventListener("click",(e)=>{e.preventDefault();selectBlock(el,block);});
    block.addEventListener("touchend",(e)=>{e.preventDefault();selectBlock(el,block);});
    container.appendChild(block);
  });
}

function selectBlock(elData,blockDom){
  if(blockDom.classList.contains("solved"))return;
  document.querySelectorAll(".floating-block.selected").forEach(b=>b.classList.remove("selected"));
  selectedElement=elData;blockDom.classList.add("selected");
  const label=document.getElementById("currentSelection");
  label.textContent=elData.n;label.style.color=elData.color;
  mainInput.value="";mainInput.maxLength=elData.s.length;
  mainInput.placeholder="_".repeat(elData.s.length);
  setTimeout(()=>{mainInput.focus();},100);
}

function checkAnswer(){
  if(!selectedElement){document.getElementById("currentSelection").classList.add("shake");setTimeout(()=>document.getElementById("currentSelection").classList.remove("shake"),250);return;}
  const targetSym=selectedElement.s.toUpperCase(),userInput=mainInput.value.toUpperCase();
  if(userInput===targetSym){
    playCorrect();
    const block=document.getElementById(`block-${selectedElement.s}`),slot=document.getElementById(`slot-${selectedElement.s}`);
    const slotRect=slot.getBoundingClientRect(),containerRect=document.getElementById("blocksContainer").getBoundingClientRect();
    block.style.transform="rotate(0deg) scale(1)";
    block.style.left=(slotRect.left-containerRect.left)+"px";
    block.style.top=(slotRect.top-containerRect.top)+"px";
    block.style.width=slotRect.width+"px";block.style.height=slotRect.height+"px";
    block.classList.remove("selected");block.classList.add("solved");
    block.innerHTML=`<div class="flex flex-col items-center leading-none text-white"><span class="text-[7px] opacity-80">${selectedElement.z}</span><span class="text-xs">${selectedElement.s}</span></div>`;
    document.getElementById("currentSelection").textContent="âœ… æ­¸ä½æˆåŠŸï¼";
    document.getElementById("currentSelection").style.color="#16a34a";
    selectedElement=null;mainInput.value="";mainInput.placeholder="_";mainInput.maxLength=2;
    solvedCount++;updateProgress();
    if(solvedCount===totalCount)setTimeout(()=>document.getElementById("winModal").classList.remove("hidden"),800);
  }else if(userInput.length>0){
    playWrong();mainInput.classList.add("shake");mainInput.style.borderColor="#ef4444";
    setTimeout(()=>{mainInput.classList.remove("shake");mainInput.style.borderColor="#3b82f6";mainInput.value="";},350);
  }
}

function clearInput(){mainInput.value="";mainInput.focus();}
function updateProgress(){document.getElementById("progressDisplay").textContent=`${solvedCount}/${totalCount}`;}

function askAIHint(){
  let target=selectedElement;
  if(!target){
    const unsolved=elements.filter(e=>{const b=document.getElementById(`block-${e.s}`);return b&&!b.classList.contains("solved");});
    if(unsolved.length===0){showAiModal("å¦³å·²ç¶“å…¨éƒ¨æ‹¼å¥½äº†ï¼è¶…å¼·çš„ï½ ğŸŒŸ");return;}
    target=unsolved[Math.floor(Math.random()*unsolved.length)];
    const b=document.getElementById(`block-${target.s}`);if(b)selectBlock(target,b);
  }
  showAiModal(`<p class="text-base leading-relaxed">ğŸ‘‹ å°æç¤ºä¾†å›‰ï¼<br><br>å¦³é¸åˆ°çš„å…ƒç´ æ˜¯ï¼š<strong class="text-indigo-700 text-lg">${target.n}</strong><br>ä»–çš„åŸå­åºæ˜¯ï¼š<strong class="text-green-600 text-lg">${target.z}</strong><br>ç¬¦è™Ÿæ˜¯ï¼š<strong class="text-amber-600 text-lg">${target.s}</strong><br><br>æ‰¾åˆ°é€±æœŸè¡¨å°æ‡‰çš„ä½ç½®æ”¾é€²å»å§ï¼</p>`);
}

function showAiModal(content){document.getElementById("aiModal").classList.remove("hidden");document.getElementById("aiContent").innerHTML=content;}
function closeAiModal(){document.getElementById("aiModal").classList.add("hidden");}
</script>
</body>
</html>
